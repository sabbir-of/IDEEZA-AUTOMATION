LavaPack.loadBundle([[999,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BaseController=void 0;class r{constructor(e={},t={}){this.defaultConfig={},this.defaultState={},this.disabled=!1,this.name="BaseController",this.internalConfig=this.defaultConfig,this.internalState=this.defaultState,this.internalListeners=[],this.initialState=t,this.initialConfig=e}initialize(){return this.internalState=this.defaultState,this.internalConfig=this.defaultConfig,this.configure(this.initialConfig),this.update(this.initialState),this}get config(){return this.internalConfig}get state(){return this.internalState}configure(e,t=!1,n=!0){if(n){this.internalConfig=t?e:Object.assign(this.internalConfig,e);for(const e in this.internalConfig)void 0!==this.internalConfig[e]&&(this[e]=this.internalConfig[e])}else for(const t in e)void 0!==this.internalConfig[t]&&(this.internalConfig[t]=e[t],this[t]=e[t])}notify(){this.disabled||this.internalListeners.forEach((e=>{e(this.internalState)}))}subscribe(e){this.internalListeners.push(e)}unsubscribe(e){const t=this.internalListeners.findIndex((t=>e===t));return t>-1&&this.internalListeners.splice(t,1),t>-1}update(e,t=!1){this.internalState=t?Object.assign({},e):Object.assign({},this.internalState,e),this.notify()}}n.BaseController=r,n.default=r}}},{package:"@metamask/address-book-controller>@metamask/base-controller",file:"node_modules/@metamask/address-book-controller/node_modules/@metamask/base-controller/dist/BaseController.js"}],[4,{"../../shared/constants/app":3955,"../../shared/constants/metametrics":3965,"../../shared/modules/browser-runtime.utils":3989,"../../shared/modules/mv3.utils":3999,"../../shared/modules/object.utils":4001,"./first-time-state":28,"./lib/createStreamSink":43,"./lib/ens-ipfs/setup":49,"./lib/get-first-preferred-lang-code":51,"./lib/getObjStructure":52,"./lib/local-store":55,"./lib/migrator":58,"./lib/network-store":59,"./lib/notification-manager":60,"./lib/setup-initial-state-hooks":82,"./lib/setupSentry":83,"./lib/util":91,"./metamask-controller":92,"./migrations":209,"./platforms/extension":210,"@metamask/controller-utils":1063,"@metamask/obs-store":1398,"@metamask/utils":1767,"debounce-stream":2564,"end-of-stream":2603,"eth-rpc-errors":2665,events:2749,"extension-port-stream":2752,loglevel:3326,pump:3503,"webextension-polyfill":3937},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.loadStateFromPersistence=le,n.setupController=ue,n.statePersistenceEvents=void 0,e("./lib/setup-initial-state-hooks");var r=L(e("events")),a=L(e("end-of-stream")),o=L(e("pump")),s=L(e("debounce-stream")),i=L(e("loglevel")),l=L(e("webextension-polyfill")),c=e("@metamask/obs-store"),u=e("@metamask/utils"),d=e("@metamask/controller-utils"),f=L(e("extension-port-stream")),p=e("eth-rpc-errors"),g=e("../../shared/constants/app"),m=e("../../shared/constants/metametrics"),h=e("../../shared/modules/browser-runtime.utils"),E=e("../../shared/modules/mv3.utils"),C=e("../../shared/modules/object.utils"),b=L(e("./migrations")),T=L(e("./lib/migrator")),S=L(e("./platforms/extension")),v=L(e("./lib/local-store")),O=(L(e("./lib/network-store")),e("./lib/setupSentry")),_=L(e("./lib/createStreamSink")),M=R(e("./lib/notification-manager")),w=R(e("./metamask-controller")),N=L(e("./first-time-state")),A=L(e("./lib/get-first-preferred-lang-code")),y=L(e("./lib/getObjStructure")),P=L(e("./lib/ens-ipfs/setup")),k=e("./lib/util");function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(I=function(e){return e?n:t})(e)}function R(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=I(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function L(e){return e&&e.__esModule?e:{default:e}}const j=new v.default;global.stateHooks.getMostRecentPersistedState=()=>j.mostRecentRetrievedState;const{sentry:U}=global,F={...N.default},D={[g.ENVIRONMENT_TYPE_POPUP]:!0,[g.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[g.ENVIRONMENT_TYPE_FULLSCREEN]:!0},B=["trezor-connect"];i.default.setLevel("info",!1);const x=new S.default,V=new M.default;let Y=!1,G=!1,q=!1;const K={},$={};let z,H;const Q={};const J=new URL("https://metamask.github.io/phishing-warning/v3.0.3/"),W=1e3,X=n.statePersistenceEvents=new r.default,{promise:Z,resolve:ee,reject:te}=(0,k.deferredPromise)(),ne=async()=>{const e=await l.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then((e=>((0,h.checkForLastErrorAndLog)(),e))).catch((()=>{(0,h.checkForLastErrorAndLog)()}));for(const t of e)l.default.tabs.sendMessage(t.id,{name:g.EXTENSION_MESSAGES.READY}).then((()=>{(0,h.checkForLastErrorAndLog)()})).catch((()=>{(0,h.checkForLastErrorAndLog)()}))};let re,ae;function oe(){const e=(new Date).toISOString();l.default.storage.session.set({timestamp:e})}async function se(){try{const e=await le(),t=e.data,n=await(0,A.default)();let r;if(E.isManifestV3){const e=2e3;oe(),setInterval(oe,e);const t=await l.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);r=(null==t?void 0:t.isFirstMetaMaskControllerSetup)===undefined,await l.default.storage.session.set({isFirstMetaMaskControllerSetup:r})}ue(t,n,{},r,e.meta),E.isManifestV3||await async function(){let e;try{const t=new URL("https://metamask.github.io/phishing-warning/v3.0.3/");let n,r;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const a=new Promise(((e,t)=>{n=e,r=t}));e.addEventListener("load",n),window.document.body.appendChild(e),setTimeout((()=>r(new ie)),W),await a}catch(e){e instanceof ie?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await ne(),i.default.info("MetaMask initialization complete."),ee()}catch(e){te(e)}}l.default.runtime.onConnect.addListener((async(...e)=>{await Z,re(...e)})),l.default.runtime.onConnectExternal.addListener((async(...e)=>{await Z,ae(...e)}));class ie extends Error{constructor(){super("Timeout failed")}}async function le(){const e=new T.default({migrations:b.default});if(e.on("error",console.warn),H=await j.get()||e.generateInitialState(F),H&&!H.data&&(H=e.generateInitialState(F),U.captureMessage("MetaMask - Empty vault found - unable to recover")),e.on("error",(e=>{const t=(0,y.default)(H);U.captureException(e,{extra:{vaultStructure:t}})})),H=await e.migrateData(H),!H)throw new Error("MetaMask - migrator returned undefined");if(!(0,u.isObject)(H.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof H.meta}'`);if("number"!=typeof H.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof H.meta.version}'`);if(!(0,u.isObject)(H.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof H.data}'`);return j.setMetadata(H.meta),j.set(H.data),H}function ce(e,t,n){if(!(0,u.hasProperty)(t.permissions,"eth_accounts"))return;const r=Object.keys(n.store.getState().identities).length,a=t.permissions.eth_accounts.caveats;if(a){const t=a[0].value.length;z.metaMetricsController.trackEvent({event:m.MetaMetricsEventName.DappViewed,category:m.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:r,number_of_accounts_connected:t}})}}function ue(e,t,n,r,u){var h;z=new w.default({infuraProjectId:"b6bf7d3508c941499b10025c0776eaf8",showUserConfirmation:de,initState:e,initLangCode:t,platform:x,notificationManager:V,browser:l.default,getRequestAccountTabIds:()=>$,getOpenMetamaskTabsIds:()=>K,localStore:j,overrides:n,isFirstMetaMaskControllerSetup:r,currentMigrationVersion:u.version,featureFlags:{}}),(0,P.default)({getCurrentChainId:()=>z.networkController.state.providerConfig.chainId,getIpfsGateway:z.preferencesController.getIpfsGateway.bind(z.preferencesController),getUseAddressBarEnsResolution:()=>z.preferencesController.store.getState().useAddressBarEnsResolution,provider:z.provider}),(0,o.default)((0,c.storeAsStream)(z.store),(0,s.default)(1e3),(0,_.default)((async e=>{await j.set(e),X.emit("state-persisted",e)})),(e=>{i.default.error("MetaMask - Persistence pipeline failed",e)})),h=z,global.stateHooks.getSentryAppState=function(){const e=h.memStore.getState();return(0,C.maskObject)(e,O.SENTRY_BACKGROUND_STATE)};const b=()=>Y||Boolean(Object.keys(K).length)||G,T=(e,t)=>{if(!1===e)z.onClientClosed();else{if(t===g.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(K).length))return;z.onEnvironmentTypeClosed(t)}};function S(){let e="";const t=v();t&&(e=String(t)),E.isManifestV3?(l.default.action.setBadgeText({text:e}),l.default.action.setBadgeBackgroundColor({color:"#037DD6"})):(l.default.browserAction.setBadgeText({text:e}),l.default.browserAction.setBadgeBackgroundColor({color:"#037DD6"}))}function v(){let e=z.appStateController.waitingForUnlock.length;return z.preferencesController.getUseRequestQueue()?e+=z.queuedRequestController.length():e+=z.approvalController.getTotalApprovalCount(),e}re=async e=>{var t;const r=e.name;if(B.includes(e.name))return;let o=!1;const s=(0,k.getPlatform)(),i=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(o=s===g.PLATFORM_FIREFOX?D[r]:(null==i?void 0:i.origin)===`chrome-extension://${l.default.runtime.id}`,o){var c;const t=(null==n||null===(c=n.getPortStream)||void 0===c?void 0:c.call(n,e))||new f.default(e);if(z.isClientOpen=!0,z.setupTrustedCommunication(t,e.sender),r===g.ENVIRONMENT_TYPE_POPUP&&(Y=!0,(0,a.default)(t,(()=>{Y=!1;const e=b();z.isClientOpen=e,T(e,g.ENVIRONMENT_TYPE_POPUP)}))),r===g.ENVIRONMENT_TYPE_NOTIFICATION&&(G=!0,(0,a.default)(t,(()=>{G=!1;const e=b();z.isClientOpen=e,T(e,g.ENVIRONMENT_TYPE_NOTIFICATION)}))),r===g.ENVIRONMENT_TYPE_FULLSCREEN){const n=e.sender.tab.id;K[n]=!0,(0,a.default)(t,(()=>{delete K[n];const e=b();z.isClientOpen=e,T(e,g.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(i&&i.origin===J.origin&&i.pathname===J.pathname){var u;const t=(null==n||null===(u=n.getPortStream)||void 0===u?void 0:u.call(n,e))||new f.default(e);z.setupPhishingCommunication({connectionStream:t})}else{if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,n=new URL(e.sender.url),{origin:r}=n;Object.keys(Q).includes(t)||(Q[t]=r);const a=z.permissionController.state.subjects[r],o=a!==undefined,s="New Tab"!==e.sender.tab.title;o&&s&&ce(r,a,z.preferencesController),e.onMessage.addListener((e=>{e.data&&e.data.method===g.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&($[r]=t)}))}ae(e)}},ae=e=>{var t;const r=(null==n||null===(t=n.getPortStream)||void 0===t?void 0:t.call(n,e))||new f.default(e);z.setupUntrustedCommunication({connectionStream:r,sender:e.sender})},null!=n&&n.registerConnectListeners&&n.registerConnectListeners(re,ae),S(),z.decryptMessageController.hub.on(w.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,S),z.encryptionPublicKeyController.hub.on(w.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,S),z.signatureController.hub.on(w.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,S),z.appStateController.on(w.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,S),z.controllerMessenger.subscribe(w.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,S),z.txController.initApprovals(),z.controllerMessenger.subscribe("QueuedRequestController:countChanged",(e=>{S(),e>0&&de()})),V.on(M.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{z.preferencesController.getUseRequestQueue()||(e?v()>0&&de():(z.signatureController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE_SIG),z.decryptMessageController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE),z.encryptionPublicKeyController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE),Object.values(z.approvalController.state.pendingApprovals).forEach((({id:e,type:t})=>{switch(t){case d.ApprovalType.SnapDialogAlert:case d.ApprovalType.SnapDialogPrompt:z.approvalController.accept(e,null);break;case d.ApprovalType.SnapDialogConfirmation:case g.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation:case g.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval:case g.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect:z.approvalController.accept(e,!1);break;default:z.approvalController.reject(e,p.ethErrors.provider.userRejectedRequest())}}))),S())})),Object.keys(z.snapController.state.snaps).length>0&&z.snapController.updateBlockedSnaps()}async function de(){const e=await x.getActiveTabs(),t=Boolean(e.find((e=>K[e.id]))),n=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!q&&(n||!Y)&&!t){q=!0;try{const e=z.appStateController.getCurrentPopupId();await V.showPopup((e=>z.appStateController.setCurrentPopupId(e)),e)}finally{q=!1}}}const fe=()=>{if(z)return z.metaMetricsController.updateTraits({[m.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void z.metaMetricsController.addEventBeforeMetricsOptIn({category:m.MetaMetricsEventCategory.App,event:m.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout((()=>{fe()}),1e3)};async function pe(){Boolean(await j.get())||(fe(),x.openExtensionInBrowser()),l.default.tabs.onActivated.addListener((e=>{if(z){const{tabId:t}=e,n=Q[t];if(n){const e=z.permissionController.state.subjects[n];e!==undefined&&ce(n,e,z.preferencesController)}}}))}(async function(){await pe(),se().catch(i.default.error)})()}}},{package:"$root$",file:"app/scripts/background.js"}]],[4],{});